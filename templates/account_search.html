<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Account Search • Trace3 × Pure</title>
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="12" fill="%23f04e23"/><circle cx="46" cy="18" r="10" fill="white" stroke="%23f04e23" stroke-width="4"/></svg>'/>
  <style>
    :root{
      --pure-orange:#f04e23; --pure-orange-700:#d9431c;
      --ink-900:#0f1115; --slate-800:#1d2127; --slate-700:#374151; --slate-600:#4b5563;
      --slate-300:#d1d5db; --slate-200:#e5e7eb; --bg:#f6f7fb; --card:#ffffff; --ok:#16a34a;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink-900);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
    .wrap{max-width:1040px;margin:0 auto;padding:28px 16px 40px;}
    .brandbar{background:#fff;border-bottom:4px solid var(--pure-orange);border-radius:14px;box-shadow:0 10px 30px rgba(15,17,21,.06);padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:16px}
    .logos{display:flex;align-items:center;gap:14px}
    .logo{height:28px;display:block}
    .logo.trace3{height:36px}
    .header{margin-top:16px;background:linear-gradient(180deg,#fff 0%, #fff 60%, #fdf2ec 100%);border:1px solid var(--slate-200);border-radius:16px;padding:18px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .title{font-weight:800;letter-spacing:.02em}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;font-weight:700;font-size:14px;color:#fff;background:var(--pure-orange);border:1px solid var(--pure-orange);border-radius:12px;cursor:pointer;box-shadow:0 8px 20px rgba(240,78,35,.25);transition:transform .04s ease, background .12s ease}
    .btn:hover{background:var(--pure-orange-700);transform:translateY(-1px)}
    .ghost{background:#fff;color:var(--pure-orange);border-color:#ffd5c9}
    .gate{margin-top:14px;display:flex;gap:8px;align-items:center}
    .input{width:100%;max-width:320px;padding:12px 14px;border:1px solid var(--slate-200);border-radius:12px;background:#fff;font-size:16px;outline:none}
    .input:focus{border-color:var(--pure-orange);box-shadow:0 0 0 4px #fde3db}
    .status{margin-top:6px;color:var(--slate-600);font-size:12px}
    .row{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;margin-top:14px}
    .ta-wrap{position:relative}
    .ta-list{position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid var(--slate-200);border-radius:12px;margin-top:6px;max-height:280px;overflow:auto;box-shadow:0 12px 24px rgba(2,6,23,.08);z-index:20}
    .ta-item{padding:10px 12px;cursor:pointer}
    .ta-item:hover{background:#f1f5f9}
    .grid{margin-top:16px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}
    @media (max-width:780px){.grid{grid-template-columns:1fr}.span2{grid-column:auto}}
    .span2{grid-column:1/-1}
    .field{position:relative;background:var(--card);border:1px solid var(--slate-200);border-radius:16px;box-shadow:0 10px 30px rgba(15,17,21,.06);padding:14px 14px 16px 14px;min-height:72px}
    .label{font-weight:800;font-size:12px;letter-spacing:.04em;text-transform:uppercase;color:#475569;margin-bottom:6px}
    .value{font-weight:600;font-size:16px;color:#0b1220;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-right:36px}
    .value a{color:inherit;text-decoration:none;border-bottom:1px dotted #cbd5e1}
    .value a:hover{border-bottom-color:var(--pure-orange)}
    .copy{position:absolute;top:10px;right:10px;display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;padding:0;border-radius:8px;background:transparent;border:1px solid transparent;color:#64748b;opacity:.45;cursor:pointer;transition:opacity .15s ease, transform .04s ease, background .2s ease}
    .field:hover .copy,.copy:focus{opacity:1}
    .copy:hover{background:#f8fafc}
    .copy:active{transform:scale(.96)}
    .copy svg{width:16px;height:16px}
    .copy.ok{color:var(--ok);background:#ecfdf5;border-color:#bbf7d0;opacity:1}
    footer{margin-top:22px;text-align:center;color:var(--slate-600);font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="brandbar">
      <div class="s">
        <a href="/"><img src="/static/pure-storage-logo.png" alt="Pure Storage" class="logo" onerror="this.style.display='none'"></a>
      </div>
      <div class="logos">
        <img src="/static/trace3-logo.png" alt="TRACE3" class="logo trace3" onerror="this.style.display='none'">
      </div>
    </div>

    <div class="header">
      <div class="title">Account Search</div>
      <div>
        <button id="copyAllBtn" class="btn" type="button" title="Copy all fields (Slack markup)">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width:16px;height:16px"><path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1Zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm-2 6H10v2h7v-2Z"/></svg>
          Copy All
        </button>
      </div>
    </div>

    <div class="gate" id="passwordRow">
      <input type="password" id="passwordInput" class="input" placeholder="Enter password"/>
      <button id="passwordBtn" class="btn" type="button">Submit</button>
      <span id="gateMsg" class="status">Locked • account-search v2.4</span>
    </div>

    <div class="row ta-wrap">
      <input id="accountInput" class="input" placeholder="Start typing to search..." autocomplete="off" disabled/>
      <div id="taList" class="ta-list" hidden></div>
    </div>
    <div class="status" id="statusLine"></div>

    <section class="grid" aria-live="polite">
      <div class="field">
        <div class="label">Pure AE</div>
        <div class="value" id="owner">-</div>
        <button class="copy" data-target="owner" aria-label="Copy Pure AE" title="Copy">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1Zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H8V7h11v14Z"/></svg>
        </button>
      </div>

      <div class="field">
        <div class="label">Pure AE Email</div>
        <div class="value" id="email">-</div>
        <button class="copy" data-target="email" aria-label="Copy Pure AE Email" title="Copy">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1Zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H8V7h11v14Z"/></svg>
        </button>
      </div>

      <div class="field span2">
        <div class="label">Pure RSD</div>
        <div class="value" id="manager">-</div>
        <button class="copy" data-target="manager" aria-label="Copy Pure RSD" title="Copy">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1Zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H8V7h11v14Z"/></svg>
        </button>
      </div>

      <div class="field span2">
        <div class="label">Regional PAM</div>
        <div class="value" id="pam">-</div>
        <button class="copy" data-target="pam" aria-label="Copy Regional PAM" title="Copy">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1Zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H8V7h11v14Z"/></svg>
        </button>
      </div>
    </section>

    <footer>Styled to match Pure x Trace3. Logos expected in /static.</footer>
  </div>

  <script>
    // All ASCII strings for maximum parser compatibility
    const PASSWORD_VALUE = "team2025";

    const accountInput = document.getElementById("accountInput");
    const ownerSpan = document.getElementById("owner");
    const managerSpan = document.getElementById("manager");
    const pamSpan = document.getElementById("pam");
    const emailSpan = document.getElementById("email");
    const statusLine = document.getElementById("statusLine");
    const copyAllBtn = document.getElementById("copyAllBtn");
    const taList = document.getElementById("taList");

    // Password gate
    const passwordRow = document.getElementById("passwordRow");
    const passwordInput = document.getElementById("passwordInput");
    const passwordBtn = document.getElementById("passwordBtn");
    const gateMsg = document.getElementById("gateMsg");

    function setValues(obj){
      obj = obj || {};
      ownerSpan.textContent = obj.owner ? obj.owner : "-";
      managerSpan.textContent = obj.manager ? obj.manager : "-";
      pamSpan.textContent = obj.pam ? obj.pam : "-";
      var e = obj.email ? obj.email : "";
      if (e && e.indexOf("@") !== -1){
        emailSpan.innerHTML = '<a href="mailto:' + e + '">' + e + "</a>";
      } else {
        emailSpan.textContent = e || "-";
      }
    }

    function fetchJSON(url){
      return fetch(url, {credentials:"omit"}).then(function(r){
        if(!r.ok) throw new Error("HTTP " + r.status);
        return r.json();
      });
    }

    function renderSuggestions(items){
      if(!items || !items.length){ taList.hidden = true; taList.innerHTML = ""; return; }
      taList.innerHTML = items.map(function(n){
        return '<div class="ta-item" data-name="' + n.replace(/"/g,'&quot;') + '">' + n + "</div>";
      }).join("");
      taList.hidden = false;
    }

    function onType(){
      var s = accountInput.value.trim();
      if(s.length < 2){ taList.hidden = true; taList.innerHTML = ""; return; }
      fetchJSON("/api/search?q=" + encodeURIComponent(s))
        .then(function(data){ renderSuggestions(data.items || []); statusLine.textContent = "Ready"; })
        .catch(function(){ statusLine.textContent = "Search failed."; });
    }
    accountInput.addEventListener("input", onType);
    document.addEventListener("click", function(e){ if(!e.target.closest(".ta-wrap")) taList.hidden = true; });
    taList.addEventListener("click", function(e){
      var item = e.target.closest(".ta-item"); if(!item) return;
      accountInput.value = item.getAttribute("data-name");
      taList.hidden = true; taList.innerHTML = "";
      fetchDetails();
    });
    accountInput.addEventListener("keydown", function(e){
      if(e.key === "Enter"){
        var first = taList.querySelector(".ta-item");
        if(first){
          accountInput.value = first.getAttribute("data-name");
          taList.hidden = true; taList.innerHTML = "";
          fetchDetails();
        }
      }
    });

    function fetchDetails(){
      var name = accountInput.value.trim(); if(!name) return;
      fetchJSON("/api/get?name=" + encodeURIComponent(name))
        .then(function(data){
          if(!data.found){ setValues(); return; }
          setValues({owner:data.owner, manager:data.manager, pam:data.pam, email:data.email});
        })
        .catch(function(){ statusLine.textContent = "Lookup failed."; });
    }

    // Copy buttons
    document.addEventListener("click", function(e){
      var btn = e.target.closest(".copy"); if(!btn) return;
      var id = btn.getAttribute("data-target");
      var el = document.getElementById(id);
      var txt = el ? (el.textContent || el.innerText || "").trim() : "";
      if(!txt) return;
      navigator.clipboard.writeText(txt).then(function(){
        btn.classList.add("ok"); setTimeout(function(){ btn.classList.remove("ok"); }, 800);
      });
    });

    // Copy All (Slack markup) - plain concatenation
    copyAllBtn.addEventListener("click", function(){
      var account = (accountInput.value || "").trim();
      var owner = (ownerSpan.textContent || "").trim();
      var email = (emailSpan.textContent || "").trim();
      var manager = (managerSpan.textContent || "").trim();
      var pam = (pamSpan.textContent || "").trim();
      var out = "";
      if(account) out += "*" + account + "*\n";
      out += "• *Pure AE:* " + owner;
      if(email){ out += "  |  <mailto:" + email + "|" + email + ">"; }
      out += "\n• *Pure RSD:* " + manager;
      out += "\n• *Regional PAM:* " + pam;
      navigator.clipboard.writeText(out).then(function(){
        var original = copyAllBtn.innerHTML; copyAllBtn.innerHTML = "✓ Copied";
        setTimeout(function(){ copyAllBtn.innerHTML = original; }, 1200);
      });
    });

    // Gate behavior
    function unlock(){
      passwordRow.style.display = "none";
      accountInput.disabled = false;
      statusLine.textContent = "Ready";
    }
    function checkPassword(){
      var entered = (passwordInput.value || "").trim();
      if(entered === PASSWORD_VALUE){ unlock(); }
      else{
        gateMsg.textContent = "Incorrect password. Check caps/spaces.";
        gateMsg.style.color = "#b91c1c";
      }
      passwordInput.value = "";
    }
    passwordBtn.addEventListener("click", checkPassword);
    passwordInput.addEventListener("keydown", function(e){ if(e.key === "Enter") checkPassword(); });
  </script>
</body>
</html>

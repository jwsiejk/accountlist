<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Account Search</title>
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="12" fill="%237c3aed"/><path d="M18 40h14l-7-16-7 16Z" fill="white"/></svg>'/>
  <style>
    :root{--bg:#f6f7fb;--card:#ffffff;--text:#0f172a;--muted:#64748b;--border:#e5e7eb;--accent:#7c3aed;--accent-ghost:#ede9fe;--ok:#16a34a;--danger:#b91c1c}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;padding:32px 16px}
    .wrap{max-width:900px;margin:0 auto}.card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 30px rgba(2,6,23,.06);padding:24px}
    .topbar{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:8px} h1{font-size:22px;margin:0}
    .hint{color:var(--muted);font-size:13px;margin-top:6px;margin-bottom:16px}.row{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center}
    .input{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:12px;outline:none;background:#fff;font-size:16px}
    .input:focus{border-color:var(--accent);box-shadow:0 0 0 4px var(--accent-ghost)}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;font-weight:600;font-size:14px;color:var(--accent);background:var(--accent-ghost);border:1px solid #ddd6fe;border-radius:10px;cursor:pointer;transition:transform .04s ease, background .2s ease, color .2s ease}
    .btn:active{transform:scale(.98)} .btn svg{width:16px;height:16px;flex:0 0 16px}
    .grid{margin-top:18px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media (max-width:700px){.grid{grid-template-columns:1fr}.span2{grid-column:auto}} .span2{grid-column:1 / -1}
    .field{position:relative;border:1px solid var(--border);border-radius:12px;padding:12px 14px 14px 14px;background:#fff;min-height:72px}
    .label{font-weight:700;font-size:12px;letter-spacing:.02em;text-transform:uppercase;color:#475569;margin-bottom:6px}
    .value{font-weight:600;font-size:16px;color:#0b1220;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-right:36px}
    .value a{color:inherit;text-decoration:none;border-bottom:1px dotted #cbd5e1}.value a:hover{border-bottom-color:var(--accent)}
    .copy{position:absolute;top:10px;right:10px;display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;padding:0;border-radius:8px;background:transparent;border:1px solid transparent;color:#64748b;opacity:.45;cursor:pointer;transition:opacity .15s ease, transform .04s ease, background .2s ease}
    .field:hover .copy,.copy:focus{opacity:1} .copy:hover{background:#f8fafc} .copy:active{transform:scale(.96)} .copy svg{width:16px;height:16px} .copy.ok{color:var(--ok);background:#ecfdf5;border-color:#bbf7d0;opacity:1}
    .error{margin-top:12px;color:var(--danger);font-weight:600} .muted{color:var(--muted);font-size:13px}
    .ta-wrap{position:relative} .ta-list{position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid var(--border);border-radius:12px;margin-top:6px;max-height:280px;overflow:auto;box-shadow:0 12px 24px rgba(2,6,23,.08);z-index:20}
    .ta-item{padding:10px 12px;cursor:pointer}.ta-item:hover{background:#f1f5f9} .status{margin-top:8px;font-size:12px;color:var(--muted)}
    .gate{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .eye{margin-left:-40px;cursor:pointer;user-select:none;color:#94a3b8}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <h1>Account Search</h1>
        <button id="copyAllBtn" class="btn" type="button" title="Copy all fields (Slack markup)">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1Zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm-2 6H10v2h7v-2Z"/></svg>
          Copy All
        </button>
      </div>

      <div class="gate" id="passwordRow">
        <div style="position:relative;display:flex;gap:8px;align-items:center;">
          <input type="password" id="passwordInput" class="input" placeholder="Enter password"/>
          <span id="togglePw" class="eye" title="Show/Hide">üëÅÔ∏è</span>
          <button id="passwordBtn" class="btn" type="button">Submit</button>
        </div>
        <span id="gateMsg" class="muted">Locked ‚Ä¢ account-search v2.2</span>
      </div>

      <div class="hint">Type 2+ characters to search. Select from the dropdown.</div>

      <div class="row ta-wrap">
        <input id="accountInput" class="input" placeholder="Start typing to search..." autocomplete="off" disabled/>
        <div id="taList" class="ta-list" hidden></div>
      </div>
      <div class="status" id="statusLine"></div>

      <div class="grid" aria-live="polite">
        <div class="field">
          <div class="label">Pure AE</div>
          <div class="value" id="owner">‚Äî</div>
          <button class="copy" data-target="owner" aria-label="Copy Pure AE" title="Copy">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1Zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H8V7h11v14Z"/></svg>
          </button>
        </div>

        <div class="field">
          <div class="label">Pure AE Email</div>
          <div class="value" id="email">‚Äî</div>
          <button class="copy" data-target="email" aria-label="Copy Pure AE Email" title="Copy">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1Zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H8V7h11v14Z"/></svg>
          </button>
        </div>

        <div class="field span2">
          <div class="label">Pure RSD</div>
          <div class="value" id="manager">‚Äî</div>
          <button class="copy" data-target="manager" aria-label="Copy Pure RSD" title="Copy">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1Zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H8V7h11v14Z"/></svg>
          </button>
        </div>

        <div class="field span2">
          <div class="label">Regional PAM</div>
          <div class="value" id="pam">‚Äî</div>
          <button class="copy" data-target="pam" aria-label="Copy Regional PAM" title="Copy">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1Zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H8V7h11v14Z"/></svg>
          </button>
        </div>
      </div>

      <div class="error" id="errorMessage"></div>
    </div>
  </div>

  <script>
    const PASSWORD_VALUE = 'team2025';

    const accountInput = document.getElementById('accountInput');
    const ownerSpan = document.getElementById('owner');
    const managerSpan = document.getElementById('manager');
    const pamSpan = document.getElementById('pam');
    const emailSpan = document.getElementById('email');
    const errorDiv = document.getElementById('errorMessage');
    const statusLine = document.getElementById('statusLine');
    const copyAllBtn = document.getElementById('copyAllBtn');
    const taList = document.getElementById('taList');

    // Password gate elements
    const passwordRow = document.getElementById('passwordRow');
    const passwordInput = document.getElementById('passwordInput');
    const passwordBtn = document.getElementById('passwordBtn');
    const gateMsg = document.getElementById('gateMsg');
    const togglePw = document.getElementById('togglePw');

    function setValues({owner='‚Äî',manager='‚Äî',pam='‚Äî',email='‚Äî'}={}){
      ownerSpan.textContent = owner || '‚Äî';
      managerSpan.textContent = manager || '‚Äî';
      pamSpan.textContent = pam || '‚Äî';
      if (email && email.includes('@')){
        emailSpan.innerHTML = `<a href="mailto:${email}">${email}</a>`;
      } else {
        emailSpan.textContent = email || '‚Äî';
      }
    }
    function err(msg){ errorDiv.textContent = msg; }

    async function fetchJSON(url){
      const r = await fetch(url, { credentials:'omit' });
      if (!r.ok) throw new Error('HTTP '+r.status);
      return await r.json();
    }

    function renderSuggestions(items){
      if (!items.length){ taList.hidden = true; taList.innerHTML = ''; return; }
      taList.innerHTML = items.map(n => `<div class="ta-item" data-name="${n.replace(/"/g,'&quot;')}">${n}</div>`).join('');
      taList.hidden = false;
    }

    async function onType(){
      const s = accountInput.value.trim();
      if (s.length < 2){ taList.hidden = true; taList.innerHTML = ''; return; }
      try{
        const data = await fetchJSON(`/api/search?q=${encodeURIComponent(s)}`);
        renderSuggestions(data.items || []);
        statusLine.textContent = 'Ready ‚Ä¢ account-search v2.2';
      }catch(e){
        err('Search failed.');
      }
    }
    accountInput.addEventListener('input', onType);
    document.addEventListener('click', (e)=>{ if (!e.target.closest('.ta-wrap')) taList.hidden = true; });
    taList.addEventListener('click', async (e)=>{
      const item = e.target.closest('.ta-item');
      if (!item) return;
      accountInput.value = item.getAttribute('data-name');
      taList.hidden = true; taList.innerHTML = '';
      await fetchDetails();
    });
    accountInput.addEventListener('keydown', async (e)=>{
      if (e.key === 'Enter'){
        const first = taList.querySelector('.ta-item');
        if (first){
          accountInput.value = first.getAttribute('data-name');
          taList.hidden = true; taList.innerHTML = '';
          await fetchDetails();
        }
      }
    });

    async function fetchDetails(){
      const name = accountInput.value.trim();
      if (!name) return;
      try{
        const data = await fetchJSON(`/api/get?name=${encodeURIComponent(name)}`);
        if (!data.found){ setValues({owner:'‚Äî', manager:'‚Äî', pam:'‚Äî', email:'‚Äî'}); return; }
        setValues({owner:data.owner, manager:data.manager, pam:data.pam, email:data.email});
        err('');
      }catch(e){
        err('Lookup failed.');
      }
    }

    // Copy buttons
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.copy');
      if (!btn) return;
      const targetId = btn.getAttribute('data-target');
      const el = document.getElementById(targetId);
      const text = el ? (el.textContent || el.innerText || '').trim() : '';
      if (!text) return;
      navigator.clipboard.writeText(text).then(()=>{
        btn.classList.add('ok');
        setTimeout(()=> btn.classList.remove('ok'), 800);
      });
    });

    // Copy All (Slack markup)
    copyAllBtn.addEventListener('click', ()=>{
      const account = (accountInput.value || '').trim();
      const owner = (ownerSpan.textContent || '').trim();
      const email = (emailSpan.textContent || '').trim();
      const manager = (managerSpan.textContent || '').trim();
      const pam = (pamSpan.textContent || '').trim();
      const lines = [];
      if (account) lines.push(`*${account}*`);
      const emailSlack = email ? `<mailto:${email}|${email}>` : '';
      lines.push(`‚Ä¢ *Pure AE:* ${owner || ''}${emailSlack ? `  |  ${emailSlack}` : ''}`);
      lines.push(`‚Ä¢ *Pure RSD:* ${manager || ''}`);
      lines.push(`‚Ä¢ *Regional PAM:* ${pam || ''}`);
      navigator.clipboard.writeText(lines.join('\n')).then(()=>{
        const original = copyAllBtn.innerHTML;
        copyAllBtn.innerHTML = '‚úì Copied';
        setTimeout(()=> copyAllBtn.innerHTML = original, 1200);
      });
    });

    // Password gate behavior (page-level only)
    function unlock(){
      passwordRow.style.display = 'none';
      accountInput.disabled = false;
      statusLine.textContent = 'Ready ‚Ä¢ account-search v2.2';
    }
    function checkPassword(){
      const entered = (passwordInput.value || '').trim();
      if (entered === PASSWORD_VALUE){
        unlock();
      }else{
        gateMsg.textContent = 'Incorrect password. Check caps/spaces.';
        gateMsg.style.color = '#b91c1c';
      }
      passwordInput.value = '';
    }
    passwordBtn.addEventListener('click', checkPassword);
    passwordInput.addEventListener('keydown', e => { if (e.key === 'Enter') checkPassword(); });
    togglePw.addEventListener('click', ()=> { passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password'; });
  </script>
</body>
</html>
